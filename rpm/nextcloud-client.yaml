Name: nextcloud-client
Summary: Nextcloud command line sync client
Version: 3.14.1
Release: 0
Group: Applications
License: GPLv2
SCM: "https://github.com/nextcloud/desktop"
URL: "https://github.com/nextcloud/desktop"
Sources:
    - '%{name}-%{version}.tar.gz'
    # for SFOS 3.x
    - 'libssl-1.0.patch'
#Patches:
Description: |
    %{summary}.

    NOTE: The library installs in /usr/lib/nextcloud for compatability reasons with OwnCloud.
    This means you will have to have that path in your LD_LIBRARY_PATH variable to use the client.

    %if "%{?vendor}" == "chum"
    Title: Nextcloud Sync Client (Qt6)
    Type: console-application
    PackagedBy: nephros
    Categories:
     - Utility
     - FileTools
     - NetworkFilesystems
    Custom:
      Repo: https://github.com/nextcloud/desktop
      PackagingRepo: https://gitlab.com/nephros/nextcloud-client
    Icon: https://avatars.githubusercontent.com/u/19211038?s=200&v=4
    Url:
      Homepage: https://nextcloud.com/install/#install-clients
      Help: https://gitlab.com/nephros/nextcloud-client/-/blob/%{version}/README_SailfishOS.md
    %endif
SetupOptions: -q -n %{name}-%{version}/upstream
#Macros:
Macros2:
  - |
    spectacle_hack_starts;here
    # add a conditional dep:
    %if 0%{?sailfishos_version} <= 40500
    BuildRequires:  pkgconfig(Qt5WebKitWidgets)
    %endif
  - spectacle_hack_ends;here

#Requires:
PkgBR:
  - pkgconfig
  - cmake
  - qt6-qtkeychain-devel
  - qt6-rpm-macros
  - qt6-qttools
  - kf6-karchive-devel
PkgConfigBR:
  - openssl
  - zlib
  - sqlite3
  - Qt6Concurrent
  - Qt6Core
  - Qt6Core5Compat
  - Qt6DBus
  - Qt6Gui
  - Qt6Linguist
  - Qt6QmlCompiler
  - Qt6Quick
  - Qt6Svg
  - Qt6WebSockets
  - Qt6Xml
  # optional
  # Qt6QmlCompilerPlusPrivate

Configure: cmake
ConfigOptions:
  - '-DCMAKE_INSTALL_LIBDIR=%{_libdir}/nextcloud'
  # this option removes Http authentication, keychain, shibboleth etc and is intended for
  # external authentication mechanisms
  - '-DTOKEN_AUTH_ONLY=OFF'
  - '-DBUILD_SHELL_INTEGRATION=OFF'
  - '-DBUILD_SHELL_INTEGRATION_ICONS=OFF'
  - '-DBUILD_SHELL_INTEGRATION_DOLPHIN=OFF'
  - '-DBUILD_SHELL_INTEGRATION_NAUTILUS=OFF'
  - '-DBUILD_GUI=OFF'
  - '-DBUILD_TESTING=OFF'
  - '-DBUILD_WITH_WEBENGINE=OFF'
Builder: none
NoIconCache: true
Files:
  - '%config %{_sysconfdir}/Nextcloud/*'
  - '%{_bindir}/nextcloudcmd'

SubPackages:
    - Name:  devel
      AutoDepend: false
      Summary:    Development files for %{name}
      Group:      Development/Libraries
      Requires:
        - '%{name}-libs = %{version}-%{release}'
      Description: |
          %{summary}.
      Files:
        - '%license COPYING'
        - '%{_includedir}/nextcloudsync/'
        # '%{_libdir}/*.so'
        - '%{_libdir}/nextcloud/*.so'

    - Name:  libs
      AutoDepend: false
      Summary:    Libraries for %{name}
      Group:      Development/Libraries
      Description: |
          %{summary}.

          %if "%{?vendor}" == "chum"
          Title: Nextcloud Client Libraries
          PackagedBy: nephros
          Categories:
           - Library
          Custom:
            Repo: https://github.com/nextcloud/desktop
            PackagingRepo: https://gitlab.com/nephros/nextcloud-client
          Icon: https://avatars.githubusercontent.com/u/19211038?s=200&v=4
          Url:
            Homepage: https://nextcloud.com/install/#install-clients
          %endif
      Files:
        # '%{_libdir}/*.so.*'
        - '%{_libdir}/nextcloud/*.so.*'

